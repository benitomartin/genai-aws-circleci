name: Deploy to AWS using SAM

on:
  push:
    branches:
      - main  # Trigger deployment on push to the main branch
  pull_request:
    branches:
      - main  # Trigger deployment on PR to the main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the repository
      uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v5

    - name: "Set up Python"
      uses: actions/setup-python@v5
      with:
        python-version-file: "pyproject.toml"
 
    - name: Install the project
      run: uv sync 

    # - name: Install dependencies
    #   run: |
    #     python -m pip install --upgrade pip
    #     pip install -r requirements.txt

    - name: Run tests
      run: uv run pytest

##

    # - name: Set up AWS CLI
    #   uses: aws-actions/configure-aws-credentials@v1
    #   with:
    #     aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
    #     aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    #     aws-region: eu-central-1  # Set to the region of your choice

    # - name: Build Lambda Deployment Package
    #   run: |
    #     chmod +x build-sam.sh
    #     ./build-sam.sh

    # - name: Build with SAM
    #   run: |
    #     sam build

    # - name: Deploy with SAM
    #   run: |
    #     sam deploy --stack-name sam-app --resolve-s3  --capabilities CAPABILITY_IAM --region eu-central-1   

    # - name: Output API Gateway URL
    #   run: |
    #     API_URL=$(aws cloudformation describe-stacks --stack-name sam-app)
    #     echo "GenAI API URL: $API_URL"
